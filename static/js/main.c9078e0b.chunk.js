(this.webpackJsonpscreenstream=this.webpackJsonpscreenstream||[]).push([[0],{38:function(e,t,n){},41:function(e,t,n){},66:function(e,t){},68:function(e,t){},81:function(e,t,n){"use strict";n.r(t);var i=n(1),r=n.n(i),a=n(27),o=n.n(a),s=(n(38),n(3)),c=n(14),d=n.n(c),l=n(28),u=n(0);function h(e){if(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)return navigator.mediaDevices.getDisplayMedia(e);if(navigator.getDisplayMedia)return navigator.getDisplayMedia(e);throw new Error("getDisplayMedia is not available.")}function v(e){if(!(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia||navigator.getDisplayMedia))return Object(u.jsx)("div",{children:"Not supported"});var t=Object(i.useState)("initial"),n=Object(s.a)(t,2),r=n[0],a=n[1],o=function(){var t=Object(l.a)(d.a.mark((function t(){var n,i,r,o;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,h({video:e.constraints||!0});case 3:n=t.sent,e.onStreamSelected&&e.onStreamSelected(n),a("selected"),i=n.getVideoTracks(),r=Object(s.a)(i,1),(o=r[0]).addEventListener("ended",(function(){e.onStreamEnded&&e.onStreamEnded(n),a("ended")})),console.log("video",o),t.next=15;break;case 11:t.prev=11,t.t0=t.catch(0),console.error(t.t0),a("error");case 15:case"end":return t.stop()}}),t,null,[[0,11]])})));return function(){return t.apply(this,arguments)}}();return"selected"===r?Object(u.jsx)("div",{children:"Stream selected"}):Object(u.jsxs)(u.Fragment,{children:["error"===r&&Object(u.jsx)("div",{children:"Error"}),Object(u.jsx)("button",{onClick:o,type:"button",children:"Select screen to share"})]})}var m=n(32),p=n(33),f=["srcObject"];function g(e){var t=e.srcObject,n=Object(p.a)(e,f),r=Object(i.useRef)(null);return Object(i.useEffect)((function(){if(r.current){var e=r.current;"srcObject"in e?e.srcObject=t:e.src=URL.createObjectURL(t)}}),[t]),Object(u.jsx)("video",Object(m.a)({ref:r},n))}n(41);var S,b=n(29),O=n(30),j=n(31),w=n.n(j),y=function(){function e(t){Object(b.a)(this,e),this.audioBandwidth=void 0,this.frameRate=void 0,this.height=void 0,this.onStream=void 0,this.onStreamEnd=void 0,this.peer=null,this.queuedStream=null,this.videoBandwidth=void 0,this.ws=void 0,this.wsChannel=void 0,this.audioBandwidth=t.audioBandwidth,this.frameRate=t.frameRate,this.height=t.height,this.onStream=t.onStream,this.onStreamEnd=t.onStreamEnd,this.videoBandwidth=t.videoBandwidth,this.wsChannel=t.wsChannel,this.ws=new WebSocket(t.wsUrl),this.initWebSocket()}return Object(O.a)(e,[{key:"initWebSocket",value:function(){var e,t=this;this.ws.addEventListener("open",(function(){t.ws.send(JSON.stringify({route:"joinChannel",channelId:t.wsChannel})),e=setInterval((function(){t.ws.send(JSON.stringify({route:"ping"}))}),5e3)})),this.ws.addEventListener("close",(function(t){console.warn("WebSocket","Closed unexpectedly",t.code,t.reason),null!=e&&clearInterval(e)})),this.ws.addEventListener("message",(function(e){var n=JSON.parse(e.data);if("error"!==n.status){if("peer"===n.route){if("signal"===n.data.type){if(null==t.peer)throw new Error("Cannot signal, peer is null.");return console.log("WebSocket","Received signal",n.data.signal),void t.peer.signal(n.data.signal)}return"text"===n.data.type&&"initializing"===n.data.text?void t.initPeer():void console.log("WebSocket","Unhandled message from peer",n)}if("joinChannel"===n.route)return console.log("WebSocket","Joined channel",n.channelId),n.numberOfMembers>1?(t.initPeer("initiator"),void t.ws.send(JSON.stringify({route:"message",data:{type:"text",text:"initializing"}}))):void console.log("WebSocket","Waiting for peer");"ping"!==n.route&&"message"!==n.route&&console.log("WebSocket","Unhandled message",n)}else console.error("WebSocket","Received error",n)}))}},{key:"initPeer",value:function(e){var t,n,i=this;this.peer=new w.a({initiator:"initiator"===e,sdpTransform:this.sdpTransform_,stream:null!==(t=this.queuedStream)&&void 0!==t?t:void 0}),this.queuedStream=null,this.peer.on("signal",(function(e){i.ws.send(JSON.stringify({route:"message",data:{type:"signal",signal:e}}))})),this.peer.on("connect",(function(){null!=i.queuedStream&&(i.peer.addStream(i.queuedStream),i.queuedStream=null),setTimeout((function(){n=setInterval((function(){i.peer.send(JSON.stringify({type:"ping"}))}),5e3)}),e?2500:0)})),this.peer.on("close",(function(){console.warn("WebRTC","Closed unexpectedly"),null!=n&&clearInterval(n)})),this.peer.on("stream",(function(e){return i.onStream(e)})),this.peer.on("data",(function(e){var t=JSON.parse(e);"streamEnding"!==t.type?"ping"!==t.type?"pong"!==t.type&&console.log("WebRTC","Unhandled message",t):i.peer.send(JSON.stringify({type:"pong"})):null!=i.onStreamEnd&&i.onStreamEnd()}))}},{key:"sdpTransform_",value:function(e){return e=e.replace(/b=AS([^\r]+\r\n)/g,""),null!=this.audioBandwidth&&(e=e.replace(/a=mid:audio\r\n/g,"a=mid:audio\r\nb=AS:".concat(this.audioBandwidth,"\r\n"))),null!=this.videoBandwidth&&(e=e.replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:".concat(this.videoBandwidth,"\r\n"))),e}},{key:"addStream",value:function(e){null!=this.peer?this.peer.addStream(e):this.queuedStream=e}},{key:"removeStream",value:function(e){null!=this.peer?(this.peer.send(JSON.stringify({type:"streamEnding"})),this.peer.removeStream(e)):this.queuedStream=null}}]),e}(),E=n(9),k=Object(E.makeValidator)((function(e){return Object(E.str)({choices:["development","test","production"]})._parse(e)})),x=Object.entries(Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_WS_URL:"wss://screenstreamserver.mattm.win:2096/v1/websocket"})).reduce((function(e,t){var n=Object(s.a)(t,2),i=n[0],r=n[1];return e[i=i.replace(/^REACT_APP_/i,"")]=r,e}),{}),C=Object(E.cleanEnv)(x,{NODE_ENV:k({default:"development"}),WS_URL:Object(E.url)()}),_=n.p+"static/media/logo.6ce24c58.svg";var R=function(){var e=Object(i.useState)(null),t=Object(s.a)(e,2),n=t[0],r=t[1];return Object(i.useEffect)((function(){S=new y({onStream:r,onStreamEnd:function(){return r(null)},wsUrl:C.WS_URL,wsChannel:window.location.hash||"test"})}),["once"]),Object(u.jsx)("div",{className:"App",children:Object(u.jsxs)("header",{className:"App-header",children:[Object(u.jsx)("img",{src:_,className:"App-logo",alt:"logo"}),Object(u.jsx)(v,{onStreamSelected:function(e){return S.addStream(e)},onStreamEnded:function(e){return S.removeStream(e)}}),n&&Object(u.jsx)(g,{width:"90%",autoPlay:!0,muted:!0,controls:!0,srcObject:n})]})})},W=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,82)).then((function(t){var n=t.getCLS,i=t.getFID,r=t.getFCP,a=t.getLCP,o=t.getTTFB;n(e),i(e),r(e),a(e),o(e)}))};o.a.render(Object(u.jsx)(r.a.StrictMode,{children:Object(u.jsx)(R,{})}),document.getElementById("root")),W()}},[[81,1,2]]]);
//# sourceMappingURL=main.c9078e0b.chunk.js.map